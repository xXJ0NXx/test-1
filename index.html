<!DOCTYPE html>
<html lang="en">
<head>
  <title>Ayuncraft With SinglePlayer</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Ayuncraft hybrid. Play Minecraft 1.5.2 in your browser with multiplayer, single player, and RSA encryption.">
  <meta name="author" content="lax1dude + ayunami">

  <!-- PixelCraft core libraries -->
  <script src="jsbn/jsbn.js"></script>
  <script src="jsbn/jsbn2.js"></script>
  <script src="jsbn/base64.js"></script>
  <script src="jsbn/prng4.js"></script>
  <script src="jsbn/rng.js"></script>
  <script src="jsbn/rsa.js"></script>
  <script src="jsbn/rsa2.js"></script>
  <script src="asn1-parser.js"></script>
  <script src="music.js"></script>
  <script src="eagswebrtc.js"></script>
  <script src="worker_bootstrap.js"></script>

  <!-- Single Player classes loaded first -->
  <script src="classes_server.js"></script>

  <style>
    /* Single Player Menu */
    #singleplayer-menu { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:none; z-index:10000; font-family:'Minecraft', monospace, sans-serif; }
    #singleplayer-menu.active { display:flex; justify-content:center; align-items:center; flex-direction:column; }
    .sp-container { background:#333; border:2px solid #666; padding:20px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; box-shadow:0 0 20px rgba(0,0,0,0.5); }
    .sp-title { color:#fff; font-size:24px; margin-bottom:20px; text-align:center; text-shadow:2px 2px 0 #000; }
    .world-list { margin-bottom:20px; max-height:300px; overflow-y:auto; border:1px solid #555; background:#222; }
    .world-item { padding:15px; border-bottom:1px solid #444; cursor:pointer; transition: background 0.2s; color:#fff; }
    .world-item:hover { background:#444; } 
    .world-item:active { background:#555; }
    .world-name { font-size:18px; font-weight:bold; margin-bottom:5px; }
    .world-info { font-size:12px; color:#aaa; }
    .sp-button { background:#666; color:#fff; border:2px solid #888; padding:10px 20px; margin:5px; cursor:pointer; font-size:16px; transition:all 0.2s; font-family:inherit; }
    .sp-button:hover { background:#777; border-color:#aaa; } 
    .sp-button:active { background:#555; }
    .sp-button.primary { background:#4a4; border-color:#6c6; } 
    .sp-button.primary:hover { background:#5b5; border-color:#8e8; }
    .sp-button.danger { background:#a44; border-color:#c66; } 
    .sp-button.danger:hover { background:#b55; border-color:#e88; }
    .button-row { display:flex; justify-content:center; flex-wrap:wrap; margin-top:15px; }
    .no-worlds { padding:30px; text-align:center; color:#888; font-style:italic; }
    #create-world-form { display:none; margin-top:20px; padding:15px; background:#222; border:1px solid #555; }
    #create-world-form.active { display:block; }
    #create-world-form input { width:100%; padding:10px; margin:10px 0; background:#333; border:1px solid #555; color:#fff; font-size:16px; font-family:inherit; box-sizing:border-box; }
    #create-world-form label { color:#fff; display:block; margin-top:10px; }

    /* Floating Single Player Button */
    .sp-float-btn { position: fixed; top:20px; right:20px; z-index:99999; background:#4a4; border:2px solid #6c6; color:#fff; font-family:'Minecraft', monospace, sans-serif; font-size:16px; padding:12px 20px; border-radius:8px; cursor:pointer; box-shadow:0 0 10px rgba(0,0,0,0.5); display:block; }
    .sp-float-btn:hover { background:#5b5; border-color:#8e8; }
    .sp-float-btn:active { background:#3a3; }
  </style>
</head>
<body style="margin:0;width:100vw;height:100vh;" id="game_frame">

  <!-- Single Player Menu Overlay -->
  <div id="singleplayer-menu">
    <div class="sp-container">
      <div class="sp-title">Select World</div>
      <div class="world-list" id="world-list">
        <div class="no-worlds">No worlds yet. Create a new world to get started!</div>
      </div>
      <div id="create-world-form">
        <label for="world-name-input">World Name:</label>
        <input type="text" id="world-name-input" placeholder="My World" maxlength="32" />
        <label for="world-seed-input">Seed (optional):</label>
        <input type="text" id="world-seed-input" placeholder="Leave blank for random" />
        <div class="button-row">
          <button class="sp-button primary" onclick="createWorld()">Create World</button>
          <button class="sp-button" onclick="cancelCreateWorld()">Cancel</button>
        </div>
      </div>
      <div class="button-row">
        <button class="sp-button primary" onclick="showCreateWorldForm()">Create New World</button>
        <button class="sp-button" onclick="closeSinglePlayerMenu()">Back to Menu</button>
      </div>
    </div>
  </div>

  <!-- Floating Single Player Button -->
  <button id="open-singleplayer-btn" class="sp-float-btn" onclick="openSinglePlayerAndHide()">Single Player</button>

<script>
var name="Ayuncraft", motd="A public 1.5.2 server", ip="pixelcraft.me";

// === Single Player Button / Menu ===
function openSinglePlayerAndHide(){ document.getElementById('open-singleplayer-btn').style.display='none'; showSinglePlayerMenu(); }
function showSinglePlayerMenu(){ document.getElementById('singleplayer-menu').classList.add('active'); refreshWorldList(); if(document.exitPointerLock) document.exitPointerLock(); }
function closeSinglePlayerMenu(){ document.getElementById('singleplayer-menu').classList.remove('active'); document.getElementById('create-world-form').classList.remove('active'); }

// === Worlds ===
const WORLDS_KEY='minecraft_worlds';
function getWorlds(){ try{ return JSON.parse(localStorage.getItem(WORLDS_KEY))||[]; }catch(e){ return[]; } }
function saveWorlds(w){ try{ localStorage.setItem(WORLDS_KEY,JSON.stringify(w)); return true; }catch(e){ alert('Failed to save world'); return false; } }
function refreshWorldList(){
  const worlds=getWorlds(), worldList=document.getElementById('world-list');
  if(worlds.length===0){ worldList.innerHTML='<div class="no-worlds">No worlds yet. Create a new world to get started!</div>'; return; }
  worldList.innerHTML='';
  worlds.forEach((w,i)=>{
    const item=document.createElement('div'); item.className='world-item'; item.onclick=()=>loadWorld(i);
    const n=document.createElement('div'); n.className='world-name'; n.textContent=w.name;
    const info=document.createElement('div'); info.className='world-info'; info.textContent=`Created: ${new Date(w.created).toLocaleString()}`; if(w.lastPlayed) info.textContent+=` | Last played: ${new Date(w.lastPlayed).toLocaleString()}`;
    item.appendChild(n); item.appendChild(info);
    const del=document.createElement('button'); del.className='sp-button danger'; del.style.marginTop='10px'; del.textContent='Delete';
    del.onclick=(e)=>{ e.stopPropagation(); worlds.splice(i,1); saveWorlds(worlds); refreshWorldList(); };
    item.appendChild(del); worldList.appendChild(item);
  });
}
function showCreateWorldForm(){ document.getElementById('create-world-form').classList.add('active'); document.getElementById('world-name-input').focus(); }
function cancelCreateWorld(){ document.getElementById('create-world-form').classList.remove('active'); document.getElementById('world-name-input').value=''; document.getElementById('world-seed-input').value=''; }
function createWorld(){
  const n=document.getElementById('world-name-input').value.trim()||'New World';
  const s=document.getElementById('world-seed-input').value.trim()||null;
  const worlds=getWorlds(); const w={name:n,seed:s,created:Date.now(),lastPlayed:Date.now()};
  worlds.push(w); 
  if(saveWorlds(worlds)){ 
      cancelCreateWorld(); 
      refreshWorldList(); 
      closeSinglePlayerMenu(); 
      startSinglePlayerWithWorld(w); 
      console.log('World created & loaded:',w); 
  }
}
function loadWorld(i){ const worlds=getWorlds(); const w=worlds[i]; if(!w) return alert('World not found'); w.lastPlayed=Date.now(); saveWorlds(worlds); closeSinglePlayerMenu(); startSinglePlayerWithWorld(w); }

// === Start Single Player ===
function startSinglePlayerWithWorld(world){
  if(typeof classes !== 'undefined' && classes.server){
    classes.server.start(world.seed||null);
    console.log('Single player world loaded:', world.name);
  } else {
    console.error('classes_server.js missing');
    alert('Single player unavailable.');
  }
}

// === Load modded.js and unmodded.js locally ===
function loadScript(src){ return new Promise((resolve,reject)=>{ const s=document.createElement('script'); s.src=src; s.onload=()=>resolve(); s.onerror=()=>reject(new Error('Failed to load '+src)); document.head.appendChild(s); }); }
Promise.all([loadScript('modded.js'), loadScript('unmodded.js')]).then(()=>{ console.log('✓ All game scripts loaded'); setTimeout(()=>initGame(),100); }).catch(err=>{ console.error(err); document.getElementById('game_frame').innerHTML='<div style="color:red;padding:20px;font-family:sans-serif;">Error loading game scripts: '+err.message+'</div>'; });

// === Game initialization ===
function initGame(){
  const relayId=Math.floor(Math.random()*3);
  window.eaglerRelays=[
    {addr:"wss://relay.deev.is/",name:"relay #1",primary:relayId==0},
    {addr:"wss://relay.lax1dude.net/",name:"relay #2",primary:relayId==1},
    {addr:"wss://relay.shhnowisnottheti.me/",name:"relay #3",primary:relayId==2}
  ];
  window.minecraftOpts=["game_frame","assets.epk"];
  window.singlePlayerEnabled=true;
  if(typeof main==='function'){ main(); setTimeout(()=>setupSinglePlayerHook(),2000); }
  else document.getElementById('game_frame').innerHTML='<div style="color:red;padding:20px;font-family:sans-serif;">Error: main() not found</div>';
}
function setupSinglePlayerHook(){ window.singlePlayerAvailable=(typeof classes!=='undefined' && classes.server); if(window.singlePlayerAvailable) console.log('✓ Single player ready'); else console.warn('⚠ classes_server.js missing'); }

window.openSinglePlayer=showSinglePlayerMenu;
document.addEventListener('keydown',(e)=>{ if(e.key==='F2'){ e.preventDefault(); showSinglePlayerMenu(); } });
</script>
</body>
</html>
